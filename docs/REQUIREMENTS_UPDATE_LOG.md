# éœ€æ±‚è®¾è®¡æ–‡æ¡£ä¿®æ”¹è¯´æ˜

> ä¿®æ”¹æ—¥æœŸï¼š2025-01-07
> ä¿®æ”¹äººï¼šç³»ç»Ÿ

---

## ä¿®æ”¹æ¦‚è§ˆ

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå¯¹ `REQUIREMENTS.md` æ–‡æ¡£è¿›è¡Œäº†ä»¥ä¸‹ä¸‰é¡¹é‡è¦ä¿®æ”¹ï¼š

---

## âœ… ä¿®æ”¹ 1ï¼šç»Ÿä¸€å“åº”æ•°æ®ç»“æ„

### ä¿®æ”¹å†…å®¹

æ‰€æœ‰æ¥å£å“åº”ç°åœ¨éµå¾ªç»Ÿä¸€çš„ JSON æ ¼å¼ï¼š

```json
{
  "code": 200,          // çŠ¶æ€ç 
  "msg": "success",     // æ¶ˆæ¯æè¿°
  "data": {}            // å®é™…æ•°æ®ï¼ˆæ”¾åœ¨ data å­—æ®µä¸­ï¼‰
}
```

### çŠ¶æ€ç è¯´æ˜

| code | msg | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|------|-----|-----------|------|
| 200 | success | 200 | è¯·æ±‚æˆåŠŸ |
| 400 | bad request | 400 | å‚æ•°éªŒè¯å¤±è´¥ |
| 401 | unauthorized | 401 | æœªè®¤è¯æˆ–Tokenå¤±æ•ˆ |
| 403 | forbidden | 403 | æƒé™ä¸è¶³ |
| 404 | not found | 404 | èµ„æºä¸å­˜åœ¨ |
| 409 | conflict | 409 | èµ„æºå†²çªï¼ˆå¦‚é‡å¤ï¼‰ |
| 500 | internal error | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "id": 123456789012345678,
    "username": "admin"
  }
}
```

**åˆ†é¡µå“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "items": [...]
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 400,
  "msg": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null
}
```

### æ–‡æ¡£è¯´æ˜

ä¸ºäº†ç®€åŒ–æ–‡æ¡£é˜…è¯»ï¼ŒåŠŸèƒ½éœ€æ±‚ç« èŠ‚ä¸­çš„"è¾“å‡ºç»“æœ"ç¤ºä¾‹ä»…å±•ç¤º `data` å­—æ®µçš„å†…å®¹ï¼Œå®é™…å¼€å‘æ—¶éœ€è¦åŒ…è£¹åœ¨ç»Ÿä¸€æ ¼å¼ä¸­ã€‚

---

## âœ… ä¿®æ”¹ 2ï¼šç§»é™¤çº§è”åˆ é™¤

### ä¿®æ”¹åŸå› 

é¡¹ç›®ä¸éœ€è¦ä½¿ç”¨æ•°æ®åº“çº§åˆ«çš„çº§è”åˆ é™¤åŠŸèƒ½ï¼Œæ”¹ä¸ºåœ¨åº”ç”¨å±‚é¢è¿›è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥ã€‚

### ä¿®æ”¹å†…å®¹

#### 1. ä¼šå‘˜ç­‰çº§åˆ é™¤ï¼ˆ3.2.4 èŠ‚ï¼‰

**ä¿®æ”¹å‰**ï¼š
- å¦‚æœç­‰çº§ä¸‹æœ‰å…³è”çš„ä»·æ ¼ï¼Œä¸èƒ½åˆ é™¤ï¼ˆçº§è”åˆ é™¤ï¼‰

**ä¿®æ”¹å**ï¼š
- å¦‚æœç­‰çº§ä¸‹æœ‰å…³è”çš„ä»·æ ¼ï¼Œä¸èƒ½åˆ é™¤
- å¼‚å¸¸å¤„ç†ï¼šç­‰çº§ä¸‹æœ‰ä»·æ ¼å…³è”æ—¶ï¼Œè¿”å› 400 é”™è¯¯ï¼Œæç¤º"è¯¥ç­‰çº§ä¸‹æœ‰ä»·æ ¼è®¾ç½®ï¼Œæ— æ³•åˆ é™¤"

#### 2. å•†å“åˆ é™¤ï¼ˆ3.4.5 èŠ‚ï¼‰

**ä¿®æ”¹å‰**ï¼š
- åˆ é™¤å•†å“æ—¶ï¼Œçº§è”åˆ é™¤è¯¥å•†å“çš„æ‰€æœ‰ç­‰çº§ä»·æ ¼

**ä¿®æ”¹å**ï¼š
- å¦‚æœå•†å“ä¸‹æœ‰å…³è”çš„ä»·æ ¼ï¼Œéœ€è¦å…ˆåˆ é™¤ä»·æ ¼æ‰èƒ½åˆ é™¤å•†å“
- å¼‚å¸¸å¤„ç†ï¼šå•†å“ä¸‹æœ‰ä»·æ ¼å…³è”æ—¶ï¼Œè¿”å› 400 é”™è¯¯ï¼Œæç¤º"è¯¥å•†å“æœ‰ä»·æ ¼è®¾ç½®ï¼Œè¯·å…ˆåˆ é™¤ä»·æ ¼"

### ä¸šåŠ¡è§„åˆ™å˜æ›´

åˆ é™¤æ“ä½œå‰å¿…é¡»å…ˆæ£€æŸ¥å…³è”æ•°æ®ï¼š
1. åˆ é™¤ç­‰çº§å‰ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å®¢æˆ·å…³è”ã€æ˜¯å¦æœ‰ä»·æ ¼å…³è”
2. åˆ é™¤å•†å“å‰ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä»·æ ¼å…³è”
3. å¦‚æœ‰å…³è”æ•°æ®ï¼Œæ‹’ç»åˆ é™¤å¹¶ç»™å‡ºæ˜ç¡®æç¤º

---

## âœ… ä¿®æ”¹ 3ï¼šç®¡ç†ç«¯å’Œç§»åŠ¨ç«¯åˆ†ç¦»

### ä¿®æ”¹å†…å®¹

#### 1. é¡¹ç›®ç›®æ ‡ï¼ˆ1.2 èŠ‚ï¼‰

æ–°å¢åŒç«¯è¯´æ˜ï¼š

**ç®¡ç†ç«¯ï¼ˆAdmin Webï¼‰**ï¼š
- è¶…å¸‚å†…éƒ¨ç®¡ç†äººå‘˜ä½¿ç”¨
- è¿›è¡Œç³»ç»Ÿé…ç½®ã€æ•°æ®ç®¡ç†ã€æŠ¥è¡¨æŸ¥çœ‹ç­‰æ“ä½œ
- ä»…ç®¡ç†å‘˜è´¦å·å¯ç™»å½•
- å®Œæ•´çš„æ•°æ®ç®¡ç†æƒé™

**ç§»åŠ¨ç«¯ï¼ˆMobile Appï¼‰**ï¼š
- è¶…å¸‚ä¸€çº¿é”€å”®äººå‘˜ä½¿ç”¨
- è¿›è¡Œæ—¥å¸¸é”€å”®ã€å®¢æˆ·æŸ¥è¯¢ç­‰æ“ä½œ
- æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯è®¿é—®
- åªè¯»æŸ¥è¯¢ + éƒ¨åˆ†ä¸šåŠ¡æ“ä½œï¼ˆå¦‚åº“å­˜æ›´æ–°ï¼‰
- ç®€åŒ–çš„ç•Œé¢å’Œæ“ä½œæµç¨‹

#### 2. æ ¸å¿ƒç‰¹æ€§ï¼ˆ1.4 èŠ‚ï¼‰

æ–°å¢ç‰¹æ€§ï¼š
- âœ… **åŒç«¯æ”¯æŒ**ï¼šç®¡ç†ç«¯å’Œç§»åŠ¨ç«¯åˆ†ç¦»ï¼Œæƒé™æ˜ç¡®

#### 3. API æ¥å£åˆ†ç±»ï¼ˆ7.2 èŠ‚ï¼‰

æ–°å¢æ¥å£åˆ†ç±»æ ‡è¯†ï¼š

| æ ‡è¯† | è¯´æ˜ | æƒé™ |
|------|------|------|
| ğŸ”’ | ç®¡ç†ç«¯ç‹¬æœ‰ | ä»…ç®¡ç†å‘˜å¯è®¿é—® |
| ğŸ“± | ç§»åŠ¨ç«¯ç‹¬æœ‰ | æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è®¿é—® |
| ğŸ”„ | å…±ç”¨ | ç®¡ç†ç«¯å’Œç§»åŠ¨ç«¯éƒ½å¯è®¿é—® |

#### 4. æ¥å£æƒé™è°ƒæ•´

**è®¤è¯æ¨¡å—**ï¼š
- POST /auth/registerï¼šğŸ”’ ç®¡ç†å‘˜ï¼ˆæ–°å¢ç”¨æˆ·ä»…ç®¡ç†å‘˜å¯æ“ä½œï¼‰
- POST /auth/loginï¼šå…¬å¼€ï¼ˆä¸¤ç«¯å…±ç”¨ï¼‰
- POST /auth/change-passwordï¼šğŸ”„ æ‰€æœ‰ç™»å½•ç”¨æˆ·ï¼ˆä¸¤ç«¯å…±ç”¨ï¼‰
- POST /auth/refreshï¼šğŸ”„ æ‰€æœ‰ç™»å½•ç”¨æˆ·ï¼ˆä¸¤ç«¯å…±ç”¨ï¼‰

**ç”¨æˆ·ç®¡ç†æ¨¡å—**ï¼š
- å…¨éƒ¨æ¥å£ï¼šğŸ”’ ç®¡ç†ç«¯ç‹¬æœ‰

**ä¼šå‘˜ç­‰çº§ç®¡ç†æ¨¡å—**ï¼š
- æŸ¥è¯¢æ¥å£ï¼šğŸ”„ å…±ç”¨ï¼ˆä¸¤ç«¯éƒ½å¯æŸ¥è¯¢ï¼‰
- å†™å…¥æ¥å£ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼šğŸ”’ ç®¡ç†ç«¯ç‹¬æœ‰

**å®¢æˆ·ç®¡ç†æ¨¡å—**ï¼š
- æŸ¥è¯¢æ¥å£ï¼šğŸ”„ å…±ç”¨ï¼ˆä¸¤ç«¯éƒ½å¯æŸ¥è¯¢ï¼‰
- åˆ›å»ºå®¢æˆ·ï¼šğŸ”„ å…±ç”¨ï¼ˆç§»åŠ¨ç«¯ä¹Ÿå¯åˆ›å»ºï¼‰
- ä¿®æ”¹ã€åˆ é™¤ï¼šğŸ”’ ç®¡ç†ç«¯ç‹¬æœ‰

**å•†å“ç®¡ç†æ¨¡å—**ï¼š
- æŸ¥è¯¢æ¥å£ï¼šğŸ”„ å…±ç”¨ï¼ˆä¸¤ç«¯éƒ½å¯æŸ¥è¯¢ï¼‰
- åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ï¼šğŸ”’ ç®¡ç†ç«¯ç‹¬æœ‰
- æ›´æ–°åº“å­˜ï¼šğŸ”„ å…±ç”¨ï¼ˆç§»åŠ¨ç«¯ä¹Ÿå¯æ›´æ–°åº“å­˜ï¼‰

**ä»·æ ¼ç®¡ç†æ¨¡å—**ï¼š
- æŸ¥è¯¢æ¥å£ï¼šğŸ”„ å…±ç”¨ï¼ˆä¸¤ç«¯éƒ½å¯æŸ¥è¯¢ï¼‰
- è®¾ç½®ã€åˆ é™¤ä»·æ ¼ï¼šğŸ”’ ç®¡ç†ç«¯ç‹¬æœ‰

### æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | æŸ¥è¯¢ | åˆ›å»º | æ›´æ–° | åˆ é™¤ | ç®¡ç†ç«¯ | ç§»åŠ¨ç«¯ |
|---------|------|------|------|------|--------|--------|
| ç”¨æˆ·ç®¡ç† | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ |
| ä¼šå‘˜ç­‰çº§ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ…(åªè¯») |
| å®¢æˆ·ç®¡ç† | âœ… | âœ… | âœ… | âœ… | âœ… | âœ…(åªè¯»+åˆ›å»º) |
| å•†å“ç®¡ç† | âœ… | âœ… | âœ… | âœ… | âœ… | âœ…(åªè¯»+åº“å­˜) |
| ä»·æ ¼ç®¡ç† | âœ… | âœ… | âŒ | âœ… | âœ… | âœ…(åªè¯») |

---

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

### 1. å“åº”æ ¼å¼å°è£…

å»ºè®®åˆ›å»ºç»Ÿä¸€çš„å“åº”å°è£…å‡½æ•°ï¼š

```python
# utils/response.py
from typing import Any, Optional

def success(data: Any = None, msg: str = "success") -> dict:
    """æˆåŠŸå“åº”"""
    return {
        "code": 200,
        "msg": msg,
        "data": data
    }

def error(code: int = 500, msg: str = "error", data: Any = None) -> dict:
    """é”™è¯¯å“åº”"""
    return {
        "code": code,
        "msg": msg,
        "data": data
    }

# ä½¿ç”¨ç¤ºä¾‹
return success({"id": 123, "name": "test"})
return error(400, "ç”¨æˆ·åå·²å­˜åœ¨")
```

### 2. åˆ é™¤æ“ä½œæ£€æŸ¥

åœ¨åˆ é™¤å‰è¿›è¡Œå…³è”æ£€æŸ¥ï¼š

```python
# ç¤ºä¾‹ï¼šåˆ é™¤ä¼šå‘˜ç­‰çº§
async def delete_customer_level(level_id: int):
    # æ£€æŸ¥æ˜¯å¦æœ‰å®¢æˆ·å…³è”
    customer_count = await db.query(Customers).filter_by(level_id=level_id).count()
    if customer_count > 0:
        return error(400, "è¯¥ç­‰çº§ä¸‹æœ‰å®¢æˆ·ï¼Œæ— æ³•åˆ é™¤")

    # æ£€æŸ¥æ˜¯å¦æœ‰ä»·æ ¼å…³è”
    price_count = await db.query(ProductLevelPrices).filter_by(level_id=level_id).count()
    if price_count > 0:
        return error(400, "è¯¥ç­‰çº§ä¸‹æœ‰ä»·æ ¼è®¾ç½®ï¼Œæ— æ³•åˆ é™¤")

    # æ‰§è¡Œåˆ é™¤
    await db.delete(CustomerLevels, level_id)
    return success(msg="åˆ é™¤æˆåŠŸ")
```

### 3. æƒé™æ§åˆ¶

ä½¿ç”¨ä¾èµ–æ³¨å…¥å®ç°æƒé™æ§åˆ¶ï¼š

```python
# dependencies.py
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer

security = HTTPBearer()

async def get_current_user(token: str = Depends(security)):
    """è·å–å½“å‰ç™»å½•ç”¨æˆ·"""
    # éªŒè¯ token
    user = verify_token(token)
    if not user:
        raise HTTPException(status_code=401, detail="Tokenå¤±æ•ˆ")
    return user

async def require_admin(current_user = Depends(get_current_user)):
    """è¦æ±‚ç®¡ç†å‘˜æƒé™"""
    if not current_user.admin_flag:
        raise HTTPException(status_code=403, detail="æƒé™ä¸è¶³")
    return current_user

# ä½¿ç”¨ç¤ºä¾‹
@app.post("/products", dependencies=[Depends(require_admin)])
async def create_product(...):
    # åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
    pass

@app.get("/products")
async def get_products(...):
    # æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯ä»¥è®¿é—®
    pass
```

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

- æ•°æ®åº“è®¾è®¡æ–‡æ¡£ï¼š`SQL_DESIGN.md`
- éœ€æ±‚è®¾è®¡æ–‡æ¡£ï¼š`REQUIREMENTS.md`
- API æ¥å£æ–‡æ¡£ï¼šå¾…åˆ›å»º

---

**ä¿®æ”¹å®Œæˆæ—¶é—´**ï¼š2025-01-07
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
